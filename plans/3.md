# Implementation Plan: Competitive Differentiation Ranker

## Overview

The Competitive Differentiation Ranker is a **vector function** that takes an array of startup ideas and produces a probability distribution representing relative competitive differentiation. Unlike the example scalar functions, this function must evaluate ALL items simultaneously and comparatively.

---

## Input Schema Structure

```json
{
  "type": "object",
  "description": "Input for comparing startup ideas by competitive differentiation. Provide an array of startup ideas to rank by relative differentiation strength.",
  "properties": {
    "ideas": {
      "type": "array",
      "description": "An array of startup ideas to compare. Each idea can be text, image, audio, video, or a composite array combining multiple modalities.",
      "items": {
        "anyOf": [
          {
            "type": "string",
            "description": "A text description of a startup idea (pitch, concept summary, business plan excerpt, etc.)"
          },
          {
            "type": "image",
            "description": "An image representing a startup idea (product mockup, business model canvas, pitch deck slide, etc.)"
          },
          {
            "type": "audio",
            "description": "An audio clip describing a startup idea (founder pitch, podcast excerpt, voice memo, etc.)"
          },
          {
            "type": "video",
            "description": "A video presenting a startup idea (demo day pitch, product demo, founder interview, etc.)"
          },
          {
            "type": "array",
            "description": "A composite representation combining multiple modalities for a single startup idea",
            "items": {
              "anyOf": [
                { "type": "string" },
                { "type": "image" },
                { "type": "audio" },
                { "type": "video" }
              ]
            }
          }
        ]
      },
      "minItems": 2,
      "maxItems": 10
    }
  },
  "required": ["ideas"]
}
```

### Field Descriptions

- **ideas**: The core input array containing 2-10 startup ideas to compare
  - Minimum 2 items (comparison requires at least two alternatives)
  - Maximum 10 items (practical limit for meaningful comparative evaluation)
  - Each item can be any supported modality or a composite array

---

## Input Maps

**No input maps are needed.** 

Unlike functions that process items independently (which would use input maps for parallel execution), this function must evaluate all items together in each task. The comparative nature of the evaluation requires the model to see all ideas simultaneously to produce a probability distribution.

Each task will receive the full `input.ideas` array and produce a distribution over all items.

---

## Function Definition Structure

```json
{
  "type": "vector.function",
  "description": "Rank startup ideas by relative competitive differentiation. Evaluates uniqueness, defensibility, positioning, and pivot barriers across a set of ideas, producing a probability distribution where higher scores indicate stronger relative differentiation. Accepts 2-10 startup ideas in text, image, audio, video, or composite formats.",
  "input_schema": { ... },
  "tasks": [
    // 18 vector.completion tasks evaluating different dimensions
    // Each produces a distribution over input.ideas
  ]
}
```

### Task Architecture

The function will use 18 `vector.completion` tasks organized as follows:

#### Relative Uniqueness (Tasks 1-4)
1. Problem Space Novelty
2. Solution Approach Originality  
3. Business Model Innovation
4. Target Segment Specificity

#### Defensibility and Moats (Tasks 5-9)
5. Network Effects Potential
6. Data Advantage Potential
7. Switching Cost Creation
8. Brand and Trust Requirements
9. Technical and IP Barriers

#### Competitive Positioning (Tasks 10-13)
10. Value Proposition Clarity
11. Segment Dominance Potential
12. Performance Dimension Superiority
13. Market Timing Advantage

#### Cross-Idea Pivot Barriers (Tasks 14-17)
14. Technical Capability Gaps
15. Business Model Incompatibility
16. Resource Requirements
17. First-Mover Advantage Potential

#### Integration (Task 18)
18. Holistic Differentiation Assessment

---

## Expression Patterns

### Message Content Expression

Each task needs to format all ideas into a single prompt for comparative evaluation:

```json
{
  "$starlark": "'Compare these startup ideas on [DIMENSION]:\\n\\n' + '\\n\\n---\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + (str(idea) if type(idea) == 'string' else '[Multimedia content]') for i, idea in enumerate(input['ideas'])])"
}
```

For multimodal content, we'll use a content array pattern:

```json
{
  "role": "user",
  "content": [
    {
      "type": "text",
      "text": "Compare these startup ideas on [DIMENSION]:"
    },
    {
      "$starlark": "[{'type': 'text', 'text': '\\n\\nIDEA ' + str(i+1) + ':'} for i in range(len(input['ideas']))] | interleave with ideas"
    }
  ]
}
```

**Simplified approach**: Given the complexity of multimodal interleaving, a cleaner pattern uses the raw input with a text prefix:

```json
{
  "role": "user", 
  "content": {
    "$starlark": "[{'type': 'text', 'text': 'Compare these startup ideas on [DIMENSION]. Rank them from most to least differentiated on this dimension.\\n\\nThe ideas are:'}] + [{'type': 'text', 'text': '\\n\\n--- IDEA ' + str(i+1) + ' ---\\n\\n'} if type(input['ideas'][i]) == 'string' else {'type': 'text', 'text': '\\n\\n--- IDEA ' + str(i+1) + ' ---\\n\\n'} for i in range(len(input['ideas']))]"
  }
}
```

### Response Options

For a vector function producing distributions, responses should be rankings or comparative selections. Since the number of ideas is variable (2-10), we need dynamic response generation.

**Option A: Fixed ranking responses**
```json
"responses": [
  "IDEA 1 is most differentiated on this dimension",
  "IDEA 2 is most differentiated on this dimension",
  "IDEA 3 is most differentiated on this dimension",
  ...
]
```

**Option B: Comparative pair responses (for pairwise aggregation)**
This would require many more tasks but produces cleaner probability estimates.

**Recommended approach**: Use responses that name each position, with the output scores becoming the probability distribution directly:

```json
"responses": {
  "$starlark": "['IDEA ' + str(i+1) + ' has the strongest [dimension] relative to the others' for i in range(len(input['ideas']))]"
}
```

### Output Expression

The output expression extracts the probability distribution from the vector completion:

```json
{
  "output": {
    "$starlark": "output['scores']"
  }
}
```

This directly uses the softmax scores over responses as the distribution.

---

## Detailed Task Specifications

### Task 1: Problem Space Novelty

**System Prompt:**
```
You are an expert at evaluating startup competitive landscapes. Your task is to compare these startup ideas on PROBLEM SPACE NOVELTY.

Consider for each idea:
- Is the problem fundamentally different from what others in this set are targeting?
- Does the idea address an underexplored market gap?
- How much conceptual overlap exists with other ideas in this set?
- Would solving this problem create a distinct market category?

You must select which idea occupies the MOST NOVEL problem space relative to the others. Consider how distinct each idea's problem domain is from ALL other ideas in the set.
```

**Responses:** Dynamic based on number of ideas - one response per idea claiming it has the most novel problem space.

### Task 2-17: Similar Pattern

Each task follows the same structure:
- System prompt explaining the specific dimension
- User content presenting all ideas
- Dynamic responses for each idea
- Output extracting the scores array

### Task 18: Holistic Differentiation Assessment

**System Prompt:**
```
You are an expert startup evaluator providing a HOLISTIC COMPETITIVE DIFFERENTIATION assessment. Consider all dimensions together:

- Relative Uniqueness (problem space, solution approach, business model, target segment)
- Defensibility (network effects, data advantages, switching costs, brand/trust, technical barriers)
- Competitive Positioning (value proposition clarity, segment dominance, performance dimensions, timing)
- Pivot Barriers (technical gaps, business model incompatibility, resource requirements, first-mover advantages)

Which idea occupies the MOST DEFENSIBLE AND DISTINCTIVE competitive territory overall? Consider trade-offs between dimensions - an idea strong in some areas but weak in others differs from one uniformly moderate across all dimensions.

If an investor had to allocate attention based purely on competitive differentiation, how would they distribute it?
```

---

## Aggregation Strategy

The final output aggregates all 18 task outputs. Options:

### Option 1: Simple Average
```json
{
  "$starlark": "[sum([tasks[t][i] for t in range(18)]) / 18 for i in range(len(input['ideas']))]"
}
```

### Option 2: Weighted Average
Give higher weight to moats and pivot barriers:
```json
{
  "$starlark": "normalize([sum([tasks[t][i] * weights[t] for t in range(18)]) for i in range(len(input['ideas']))])"
}
```

### Option 3: Holistic-Anchored
Use Task 18 as 50% weight, distribute remaining 50% across other tasks:
```json
{
  "$starlark": "[0.5 * tasks[17][i] + 0.5 * (sum([tasks[t][i] for t in range(17)]) / 17) for i in range(len(input['ideas']))]"
}
```

**Recommended**: Option 3 - The holistic assessment captures intuitive judgment while component tasks provide granular signal.

---

## Test Inputs

### Test 1: Two Similar Ideas (Baseline Differentiation)
```json
{
  "ideas": [
    "An AI-powered email assistant that helps professionals write better emails faster using GPT technology. Freemium model targeting knowledge workers.",
    "An AI writing tool for business emails that uses machine learning to suggest improvements. SaaS subscription for corporate teams."
  ]
}
```
**Expected**: Near-even distribution (0.45-0.55 range) - ideas are similar with minor differences.

### Test 2: Three Highly Distinct Ideas
```json
{
  "ideas": [
    "A peer-to-peer lending platform connecting small business owners in emerging markets with retail investors in developed countries. Transaction fee model with regulatory compliance in 15 countries.",
    "Autonomous drone delivery network for medical supplies in rural Sub-Saharan Africa. Hardware + service contracts with NGOs and governments.",
    "A TikTok-style short video app exclusively for cooking tutorials, with built-in grocery ordering and smart kitchen device integration. Affiliate revenue from ingredient sales."
  ]
}
```
**Expected**: Relatively even distribution (0.30-0.40 each) - all ideas are highly differentiated from each other.

### Test 3: One Standout Among Generics
```json
{
  "ideas": [
    "Yet another food delivery app connecting restaurants with hungry customers. Commission model.",
    "Food delivery service with faster delivery times. Works with local restaurants.",
    "Revolutionary vertical farming technology that grows produce 100x faster using proprietary bio-engineering, with exclusive patents and partnerships with major grocery chains.",
    "Restaurant delivery marketplace app. Takes a cut of orders.",
    "Uber for food delivery. Connects drivers with restaurants and customers."
  ]
}
```
**Expected**: Idea 3 scores significantly higher (0.50+), others split remaining probability.

### Test 4: Multimodal Input Mix
```json
{
  "ideas": [
    "A subscription box service for rare houseplants, sourcing from small growers in Southeast Asia. Direct-to-consumer with community features.",
    "[IMAGE: Product mockup of a smart plant pot with sensors]",
    "[VIDEO: 60-second pitch from founder explaining an AR app for plant care]"
  ]
}
```
**Expected**: Distribution based on actual differentiation, demonstrating multimodal handling.

### Test 5: Maximum Ideas (10 items)
```json
{
  "ideas": [
    "Idea 1: Enterprise SaaS for HR analytics",
    "Idea 2: Consumer app for personal finance",
    "Idea 3: B2B marketplace for industrial equipment",
    "Idea 4: D2C brand for sustainable fashion",
    "Idea 5: Platform for freelance developers",
    "Idea 6: AI tool for legal document review",
    "Idea 7: Hardware startup for smart home security",
    "Idea 8: EdTech platform for coding bootcamps",
    "Idea 9: HealthTech wearable for chronic disease management",
    "Idea 10: FinTech for cross-border payments"
  ]
}
```
**Expected**: Relatively even distribution with slight variations based on moat strength and uniqueness.

### Test 6: Minimum Ideas (2 items)
```json
{
  "ideas": [
    "A blockchain-based supply chain tracking system for luxury goods authentication.",
    "An NFT marketplace for digital art with built-in royalty enforcement."
  ]
}
```
**Expected**: Distribution reflects which has stronger differentiation characteristics.

### Test 7: Apples-to-Oranges (Non-competing markets)
```json
{
  "ideas": [
    "A dating app for farmers in rural America, with features for long-distance relationships and agricultural lifestyle compatibility.",
    "Enterprise software for managing pharmaceutical clinical trials, with FDA compliance automation.",
    "A mobile game teaching children Mandarin through interactive stories."
  ]
}
```
**Expected**: Distribution based on absolute differentiation quality in their respective markets, not head-to-head competition.

### Test 8: Identical Ideas
```json
{
  "ideas": [
    "An app that helps people find nearby coffee shops with good WiFi for remote work.",
    "A mobile application for discovering cafes with reliable internet connections, designed for digital nomads and remote workers.",
    "Coffee shop finder app focused on WiFi quality, targeting people who work from cafes."
  ]
}
```
**Expected**: Very even distribution (0.32-0.34 each) - ideas are essentially identical.

### Test 9: Varying Moat Strength
```json
{
  "ideas": [
    "A social network for book lovers with reading challenges and community discussions. Viral growth mechanics and social graph lock-in.",
    "An e-commerce site selling books at a slight discount. No differentiation from Amazon.",
    "A machine learning recommendation engine for books, trained on 10 years of reading behavior data with exclusive publisher partnerships."
  ]
}
```
**Expected**: Idea 3 highest (data moat + partnerships), Idea 1 moderate (network effects), Idea 2 lowest (no moat).

### Test 10: Edge Case - Audio/Video Heavy
```json
{
  "ideas": [
    "[AUDIO: 3-minute founder pitch for a podcasting analytics platform]",
    "[VIDEO: Product demo of a video editing tool for podcasters]",
    "A text-based transcription service for podcasts with SEO optimization features."
  ]
}
```
**Expected**: Demonstrates handling of audio/video modalities alongside text.

---

## Implementation Notes

1. **Dynamic Response Generation**: Since the number of ideas varies (2-10), responses must be generated dynamically using Starlark expressions.

2. **Content Array Handling**: Multimodal inputs require careful construction of content arrays that interleave text labels with the actual idea content.

3. **Normalization**: The final output must be a valid probability distribution summing to 1.0. The vector completion scores should naturally sum to ~1 via softmax, but normalization may be needed after aggregation.

4. **Prompt Length Management**: With 10 ideas, prompts could become long. System prompts should be concise while still providing clear evaluation criteria.

5. **Comparative Framing**: Every prompt must emphasize comparative evaluation - not "how differentiated is this idea" but "which of these ideas is MOST differentiated on this dimension."
