# Implementation Plan: Competitive Differentiation Ranker

## Overview

This is a **vector function** that takes an array of startup ideas and produces a probability distribution (scores summing to ~1) representing each idea's relative differentiation from the others. Unlike scalar functions that evaluate items in isolation, this function must compare all ideas simultaneously.

---

## Input Schema Structure

```json
{
  "type": "object",
  "description": "A batch of startup ideas to evaluate for relative competitive differentiation",
  "properties": {
    "items": {
      "type": "array",
      "description": "Array of startup ideas to compare. Each idea can be a text pitch, image, audio, video, or composite (array of multiple formats).",
      "items": {
        "anyOf": [
          {
            "type": "string",
            "description": "A text-based startup pitch (elevator pitch, one-pager summary, etc.)"
          },
          {
            "type": "image",
            "description": "An image-based pitch (pitch deck slide, product mockup, market diagram, etc.)"
          },
          {
            "type": "audio",
            "description": "An audio pitch (verbal elevator pitch, podcast-style explanation, etc.)"
          },
          {
            "type": "video",
            "description": "A video pitch (demo video, founder pitch, product walkthrough, etc.)"
          },
          {
            "type": "array",
            "description": "A composite pitch combining multiple formats",
            "items": {
              "anyOf": [
                {"type": "string"},
                {"type": "image"},
                {"type": "audio"},
                {"type": "video"}
              ]
            }
          }
        ]
      }
    }
  },
  "required": ["items"]
}
```

### Field Descriptions

- **items**: The core input array containing all startup ideas to be compared
  - Each item represents one startup idea
  - Items are compared against each other, not evaluated in isolation
  - The array length determines the output vector length
  - Minimum meaningful length: 2 (need at least two ideas to compare)
  - Supports multimodal inputs for richer evaluation

---

## Input Maps

This function requires a **mapped task execution pattern** because we need to:
1. Present ALL ideas to the evaluator simultaneously for comparison
2. Produce scores for each idea based on relative standing

### Primary Input Map: `all_ideas`

For most tasks, we need to present all ideas at once with indexed labels:

```json
{
  "name": "all_ideas",
  "expression": {
    "$starlark": "'\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + (str(item) if type(item) == 'string' else '[Multimodal content]') for i, item in enumerate(input['items'])])"
  }
}
```

### Alternative: Individual Item Access

For tasks that need to reference specific items:

```json
{
  "$jmespath": "input.items[0]"
}
```

---

## Function Definition Structure

```json
{
  "type": "vector.function",
  "description": "Evaluate a batch of startup ideas for relative competitive differentiation. Produces a probability distribution (scores summing to ~1) where each score represents the idea's share of total differentiation value. Higher scores indicate ideas that occupy more unique, defensible, and strategically distinct positions relative to others in the batch.",
  "input_schema": { ... },
  "output_length": {
    "$jmespath": "length(input.items)"
  },
  "tasks": [ ... ]
}
```

### Key Structural Decisions

1. **Output Length**: Dynamic, matching the number of input items
2. **Task Pattern**: Each task produces a vector of the same length as input
3. **Normalization**: Final synthesis task normalizes to probability distribution
4. **Comparison-First**: All tasks see all ideas simultaneously

---

## Task Implementations

### Consolidated Task Strategy

Given the 17 tasks identified in ESSAY_TASKS.md, we'll consolidate into 6 efficient evaluation tasks that cover the four pillars:

#### Task 1: Relative Uniqueness Evaluation
Covers: Conceptual territory, problem novelty, solution distinctiveness, target market differentiation

```json
{
  "type": "vector.completion",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert startup analyst evaluating RELATIVE UNIQUENESS across a batch of startup ideas. You must compare all ideas simultaneously and determine which occupy the most unique conceptual territory.\n\nConsider for each idea:\n- Conceptual distance from other ideas in the batch\n- Novelty of the problem being solved (vs. other problems in batch)\n- Distinctiveness of the solution approach\n- Uniqueness of the target market\n\nYou will vote for which idea has the MOST unique positioning. Ideas that are similar to others should not receive votes. Ideas that stand alone in their space should receive votes."
    },
    {
      "role": "user",
      "content": {
        "$starlark": "'Compare these startup ideas for RELATIVE UNIQUENESS. Which occupies the most distinct conceptual territory?\\n\\n' + '\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + str(item) for i, item in enumerate(input['items'])])"
      }
    }
  ],
  "responses": {
    "$starlark": "['IDEA ' + str(i+1) + ' is most unique - occupies distinct territory that no other idea in this batch shares' for i in range(len(input['items']))]"
  },
  "output": {
    "$jmespath": "output.scores"
  }
}
```

#### Task 2: Defensibility Evaluation
Covers: Network effects, technical moats, regulatory barriers, switching costs

```json
{
  "type": "vector.completion",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert startup analyst evaluating DEFENSIBILITY AND MOATS across a batch of startup ideas. Compare all ideas to determine which have the strongest structural barriers to competition.\n\nConsider for each idea:\n- Network effects potential (does value compound with users?)\n- Technical moat depth (how hard to replicate technically?)\n- Regulatory barriers (does compliance create protection?)\n- Switching costs and lock-in (how sticky would the product be?)\n\nVote for the idea with the STRONGEST defensibility. Ideas with commodity approaches should not receive votes. Ideas with structural moats should receive votes."
    },
    {
      "role": "user",
      "content": {
        "$starlark": "'Compare these startup ideas for DEFENSIBILITY. Which has the strongest moats and barriers to competition?\\n\\n' + '\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + str(item) for i, item in enumerate(input['items'])])"
      }
    }
  ],
  "responses": {
    "$starlark": "['IDEA ' + str(i+1) + ' is most defensible - has structural moats that competitors cannot easily replicate' for i in range(len(input['items']))]"
  },
  "output": {
    "$jmespath": "output.scores"
  }
}
```

#### Task 3: Competitive Positioning Evaluation
Covers: Value proposition clarity, strategic coherence, market timing, execution credibility

```json
{
  "type": "vector.completion",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert startup analyst evaluating COMPETITIVE POSITIONING across a batch of startup ideas. Compare all ideas to determine which demonstrates the clearest, most credible positioning.\n\nConsider for each idea:\n- Value proposition clarity (can you immediately understand the offer?)\n- Strategic coherence (does everything fit together logically?)\n- Market timing (is now the right moment for this idea?)\n- Execution credibility (does the pitch signal capability to deliver?)\n\nVote for the idea with the STRONGEST competitive positioning. Vague, incoherent, or poorly-timed ideas should not receive votes."
    },
    {
      "role": "user",
      "content": {
        "$starlark": "'Compare these startup ideas for COMPETITIVE POSITIONING. Which has the clearest, most credible market position?\\n\\n' + '\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + str(item) for i, item in enumerate(input['items'])])"
      }
    }
  ],
  "responses": {
    "$starlark": "['IDEA ' + str(i+1) + ' has the strongest positioning - clear value proposition, coherent strategy, good timing, credible execution' for i in range(len(input['items']))]"
  },
  "output": {
    "$jmespath": "output.scores"
  }
}
```

#### Task 4: Pivot Barrier Evaluation
Covers: Technical pivot barriers, market pivot barriers, strategic pivot barriers

```json
{
  "type": "vector.completion",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert startup analyst evaluating PIVOT BARRIERS across a batch of startup ideas. For each idea, consider how hard it would be for the OTHER ideas in the batch to pivot into its space.\n\nConsider:\n- Technical pivot cost (would others need entirely different tech stacks?)\n- Market pivot cost (would others need different customer relationships?)\n- Strategic pivot cost (would pivoting abandon their core identity?)\n\nVote for the idea that is HARDEST for others to pivot into. Ideas in adjacent spaces should not receive votes. Ideas that are strategically isolated should receive votes."
    },
    {
      "role": "user",
      "content": {
        "$starlark": "'Compare these startup ideas for PIVOT BARRIERS. Which idea is hardest for the others to pivot into?\\n\\n' + '\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + str(item) for i, item in enumerate(input['items'])])"
      }
    }
  ],
  "responses": {
    "$starlark": "['IDEA ' + str(i+1) + ' is hardest to pivot into - the other ideas would face major barriers trying to compete here' for i in range(len(input['items']))]"
  },
  "output": {
    "$jmespath": "output.scores"
  }
}
```

#### Task 5: Similarity Clustering (Inverse)
Identifies ideas that are similar to others and should share differentiation value

```json
{
  "type": "vector.completion",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert startup analyst identifying SIMILARITY AND CLUSTERING among startup ideas. Find ideas that are essentially duplicates or near-duplicates of others in the batch.\n\nConsider:\n- Are any ideas targeting the same market with similar approaches?\n- Are there clusters of ideas that would compete directly?\n- Which ideas are essentially variations of the same concept?\n\nVote for the idea that is MOST SIMILAR to others - the idea that exists in the most crowded cluster. Ideas that stand alone should NOT receive votes."
    },
    {
      "role": "user",
      "content": {
        "$starlark": "'Identify which ideas are MOST SIMILAR to others in this batch:\\n\\n' + '\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + str(item) for i, item in enumerate(input['items'])])"
      }
    }
  ],
  "responses": {
    "$starlark": "['IDEA ' + str(i+1) + ' is most similar to others - exists in a crowded cluster with direct competitors in this batch' for i in range(len(input['items']))]"
  },
  "output": {
    "$starlark": "[1.0 - score for score in output['scores']]"
  }
}
```

#### Task 6: Holistic Differentiation Synthesis
Combines all dimensions into final distribution

```json
{
  "type": "vector.completion",
  "messages": [
    {
      "role": "system",
      "content": "You are an expert startup analyst making a FINAL HOLISTIC ASSESSMENT of competitive differentiation. Consider all dimensions:\n\n1. UNIQUENESS: Which ideas occupy distinct territory?\n2. DEFENSIBILITY: Which have structural moats?\n3. POSITIONING: Which have clear, credible strategies?\n4. PIVOT BARRIERS: Which are protected from competitors?\n5. CLUSTERING: Which are isolated vs. crowded?\n\nVote for the idea with the STRONGEST OVERALL DIFFERENTIATION. This idea should stand apart from all others in the batch across multiple dimensions."
    },
    {
      "role": "user",
      "content": {
        "$starlark": "'Make a FINAL HOLISTIC assessment of competitive differentiation across all dimensions:\\n\\n' + '\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + str(item) for i, item in enumerate(input['items'])])"
      }
    }
  ],
  "responses": {
    "$starlark": "['IDEA ' + str(i+1) + ' is most differentiated overall - stands apart across uniqueness, defensibility, positioning, and isolation from competitors' for i in range(len(input['items']))]"
  },
  "output": {
    "$jmespath": "output.scores"
  }
}
```

---

## Expressions

### Dynamic Response Generation

The most critical expression is generating responses dynamically based on input length:

```starlark
['IDEA ' + str(i+1) + ' is most unique...' for i in range(len(input['items']))]
```

This creates one response option per input item, enabling proper probability distribution.

### Input Formatting

For presenting all ideas with clear labels:

```starlark
'\\n\\n'.join(['IDEA ' + str(i+1) + ':\\n' + str(item) for i, item in enumerate(input['items'])])
```

### Inverse Scoring (Similarity Penalty)

For the clustering task, we invert scores so similar ideas get penalized:

```starlark
[1.0 - score for score in output['scores']]
```

### Output Normalization

If needed, normalize to ensure sum ≈ 1:

```starlark
[score / sum(output['scores']) if sum(output['scores']) > 0 else 1.0/len(output['scores']) for score in output['scores']]
```

---

## Test Inputs

### Test 1: Clearly Differentiated Ideas (Diverse Batch)

```json
{
  "items": [
    "AI-powered legal document analysis for corporate law firms. Uses proprietary NLP trained on 10M contracts to identify risks and anomalies. Target: Fortune 500 legal departments. Moat: Unique training data from partnerships with 50 law firms.",
    "Sustainable packaging marketplace connecting eco-conscious brands with biodegradable packaging suppliers. Two-sided marketplace with supplier verification. Target: DTC consumer brands.",
    "Quantum computing simulation platform for pharmaceutical drug discovery. Reduces molecule simulation time from months to hours. Target: Top 20 pharma companies. Team: Ex-Google Quantum AI researchers.",
    "Mobile app teaching financial literacy to Gen Z through gamified micro-lessons and social challenges. Freemium model with premium coaching. Viral growth through TikTok integration."
  ]
}
```
**Expected Outcome:** Relatively uniform distribution with slight variations based on defensibility and uniqueness. Each idea occupies distinct space.

### Test 2: Clustered Ideas (Similar Concepts)

```json
{
  "items": [
    "AI chatbot for customer support automation. Reduces ticket volume by 60%. SaaS model for mid-market companies.",
    "Conversational AI platform for customer service. Uses GPT-4 to handle support queries. Target: E-commerce companies.",
    "Customer support automation using AI. Integrates with Zendesk and Intercom. Monthly subscription pricing.",
    "Blockchain-based supply chain tracking for luxury goods. Provides authentication and provenance verification. Target: Luxury brands."
  ]
}
```
**Expected Outcome:** Ideas 1-3 should share a smaller portion of differentiation value (they're similar). Idea 4 should receive a larger share (it's unique in this batch).

### Test 3: Single Standout

```json
{
  "items": [
    "Food delivery app for urban areas. Connects restaurants with customers. Commission-based model.",
    "Restaurant delivery platform. Mobile app for ordering food. Focus on fast delivery times.",
    "Space debris removal using autonomous satellites with robotic arms. First-mover in orbital cleanup. Contracts with ESA and NASA pending. Team includes former SpaceX engineers with 50+ years combined aerospace experience."
  ]
}
```
**Expected Outcome:** Ideas 1-2 should share a very small portion. Idea 3 should dominate (highly unique, defensible, and isolated).

### Test 4: All Similar (Generic Batch)

```json
{
  "items": [
    "SaaS analytics dashboard for marketing teams",
    "Marketing analytics platform with AI insights",
    "Data visualization tool for digital marketers"
  ]
}
```
**Expected Outcome:** Roughly uniform distribution (~0.33 each). No idea stands out significantly.

### Test 5: Two Ideas Only

```json
{
  "items": [
    "Telemedicine platform for mental health connecting patients with licensed therapists via video. HIPAA compliant with insurance billing integration.",
    "E-commerce platform for handmade crafts. Etsy competitor with lower fees and better seller tools."
  ]
}
```
**Expected Outcome:** Both ideas are distinct; distribution should be relatively balanced, perhaps with slight edge to whichever has stronger defensibility signals.

### Test 6: Multimodal Input

```json
{
  "items": [
    "Enterprise cybersecurity platform using behavioral AI to detect insider threats. Integrates with existing SIEM systems. SOC2 and FedRAMP certified.",
    ["This is our pitch deck", {"type": "image", "url": "https://example.com/pitchdeck.png"}],
    {"type": "video", "url": "https://example.com/demo.mp4"}
  ]
}
```
**Expected Outcome:** Function should handle mixed modalities gracefully, evaluating each based on available information.

### Test 7: Edge Case - Single Item

```json
{
  "items": [
    "The only startup idea in this batch"
  ]
}
```
**Expected Outcome:** Score of [1.0] - maximally differentiated from nothing.

### Test 8: Large Batch (10 items)

```json
{
  "items": [
    "Fintech: Neobank for freelancers with invoice financing",
    "Fintech: Business banking for startups with equity management",
    "Fintech: Payment processing for subscription businesses",
    "Healthcare: Remote patient monitoring for chronic conditions",
    "Healthcare: Mental health app with AI therapy chatbot",
    "EdTech: Coding bootcamp for career changers",
    "EdTech: Language learning app using AR/VR immersion",
    "Climate: Carbon credit marketplace for corporations",
    "Climate: Home energy audit using thermal imaging drones",
    "B2B SaaS: HR platform for distributed teams"
  ]
}
```
**Expected Outcome:** Should identify clusters (3 fintech, 2 healthcare, 2 edtech, 2 climate, 1 HR) and distribute differentiation accordingly. Unique ideas within clusters get less than isolated ideas.

---

## Summary

| Component | Implementation |
|-----------|----------------|
| **Type** | vector.function |
| **Input** | Array of multimodal startup pitches |
| **Output** | Probability distribution (length = input length) |
| **Tasks** | 6 consolidated evaluation tasks |
| **Key Challenge** | Dynamic response generation matching input length |
| **Expressions** | Starlark list comprehensions for dynamic responses |
| **Tests** | 8 scenarios covering diversity, clustering, edge cases |

The implementation prioritizes:
1. Simultaneous comparison of all ideas (not isolated evaluation)
2. Dynamic output length matching input length
3. Proper probability distribution (sum ≈ 1)
4. Coverage of all four differentiation pillars
5. Handling of multimodal inputs
